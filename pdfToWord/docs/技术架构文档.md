# PDF 转 Word 工具网站技术架构文档（简化版）

## 1. 系统架构概览

### 1.1 整体架构

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端页面      │    │   Python后端    │    │   临时存储      │
│   (HTML+jQuery) │◄──►│   (Flask)       │◄──►│   (临时目录)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │
         │                       │
         ▼                       ▼
┌─────────────────┐    ┌─────────────────┐
│   CDN缓存       │    │   文档处理      │
│   (Cloudflare)  │    │   (python-docx) │
└─────────────────┘    └─────────────────┘
```

### 1.2 技术栈选择

- **前端**：HTML5 + CSS3 + jQuery + Bootstrap
- **后端**：Python + Flask
- **文档处理**：python-docx, PyPDF2, reportlab
- **部署**：Nginx + Gunicorn

## 2. 前端架构设计

### 2.1 项目结构

```
static/
├── css/
│   ├── style.css          # 主样式文件
│   └── responsive.css     # 响应式样式
├── js/
│   ├── main.js           # 主要JavaScript逻辑
│   ├── upload.js         # 文件上传处理
│   └── conversion.js     # 转换进度处理
├── images/
│   ├── logo.png          # 网站Logo
│   ├── upload-icon.png   # 上传图标
│   └── download-icon.png # 下载图标
└── i18n/
    ├── zh.json           # 中文语言包
    └── en.json           # 英文语言包
```

### 2.2 核心 JavaScript 功能

#### 2.2.1 文件上传处理

```javascript
// upload.js
$(document).ready(function () {
  // 拖拽上传
  $("#upload-area").on("dragover", function (e) {
    e.preventDefault();
    $(this).addClass("dragover");
  });

  $("#upload-area").on("dragleave drop", function (e) {
    e.preventDefault();
    $(this).removeClass("dragover");

    if (e.type === "drop") {
      var files = e.originalEvent.dataTransfer.files;
      handleFileUpload(files[0]);
    }
  });

  // 点击上传
  $("#file-input").on("change", function () {
    var file = this.files[0];
    handleFileUpload(file);
  });
});

function handleFileUpload(file) {
  // 文件验证
  if (!validateFile(file)) {
    showError("Invalid file type or size");
    return;
  }

  // 显示上传进度
  showUploadProgress();

  // 上传文件
  uploadFile(file);
}
```

#### 2.2.2 转换进度处理

```javascript
// conversion.js
function startConversion(taskId) {
  // 显示转换进度
  showConversionProgress();

  // 轮询转换状态
  var interval = setInterval(function () {
    $.ajax({
      url: "/api/conversion/status/" + taskId,
      method: "GET",
      success: function (response) {
        updateProgress(response.progress);

        if (response.status === "completed") {
          clearInterval(interval);
          showDownloadButton(response.downloadUrl);
        } else if (response.status === "failed") {
          clearInterval(interval);
          showError(response.error);
        }
      },
      error: function () {
        clearInterval(interval);
        showError("Conversion failed");
      },
    });
  }, 2000);
}
```

#### 2.2.3 多语言支持

```javascript
// main.js
var currentLang = localStorage.getItem("language") || "zh";

function changeLanguage(lang) {
  currentLang = lang;
  localStorage.setItem("language", lang);
  loadLanguagePack(lang);
}

function loadLanguagePack(lang) {
  $.getJSON("/static/i18n/" + lang + ".json", function (data) {
    // 更新页面文本
    $("[data-i18n]").each(function () {
      var key = $(this).data("i18n");
      $(this).text(data[key]);
    });
  });
}
```

### 2.3 HTML 结构

```html
<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF转Word工具 - 免费在线转换</title>
    <meta
      name="description"
      content="免费在线PDF转Word工具，支持Word转PDF，无需注册，即用即走"
    />
    <meta name="keywords" content="PDF转Word, Word转PDF, 在线转换, 免费工具" />
    <link rel="stylesheet" href="/static/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/static/css/style.css" />
  </head>
  <body>
    <!-- 头部 -->
    <header class="header">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <h1 class="logo">PDF转Word工具</h1>
          </div>
          <div class="col-md-6 text-right">
            <div class="language-switch">
              <button class="btn btn-sm" onclick="changeLanguage('zh')">
                中文
              </button>
              <button class="btn btn-sm" onclick="changeLanguage('en')">
                English
              </button>
            </div>
            <button class="btn btn-primary" onclick="showPricing()">
              升级付费版
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- 主要内容 -->
    <main class="main-content">
      <div class="container">
        <!-- 文件上传区域 -->
        <div class="upload-section">
          <div id="upload-area" class="upload-area">
            <img src="/static/images/upload-icon.png" alt="上传" />
            <h3 data-i18n="upload.title">上传您的文件</h3>
            <p data-i18n="upload.dragDrop">拖拽文件到此处或点击上传</p>
            <input
              type="file"
              id="file-input"
              accept=".pdf,.doc,.docx"
              style="display: none;"
            />
          </div>
        </div>

        <!-- 转换选项 -->
        <div class="conversion-options">
          <div class="btn-group" role="group">
            <button
              type="button"
              class="btn btn-outline-primary active"
              data-type="pdf-to-word"
            >
              <span data-i18n="option.pdfToWord">PDF转Word</span>
            </button>
            <button
              type="button"
              class="btn btn-outline-primary"
              data-type="word-to-pdf"
            >
              <span data-i18n="option.wordToPdf">Word转PDF</span>
            </button>
          </div>
        </div>

        <!-- 转换进度 -->
        <div class="conversion-progress" style="display: none;">
          <div class="progress">
            <div
              class="progress-bar"
              role="progressbar"
              style="width: 0%"
            ></div>
          </div>
          <p class="progress-text" data-i18n="conversion.processing">
            转换中...
          </p>
        </div>

        <!-- 下载区域 -->
        <div class="download-section" style="display: none;">
          <div class="download-card">
            <img src="/static/images/download-icon.png" alt="下载" />
            <h4 data-i18n="download.title">转换完成</h4>
            <p data-i18n="download.description">
              您的文件已转换完成，点击下方按钮下载
            </p>
            <a href="#" class="btn btn-success btn-lg" id="download-btn">
              <span data-i18n="download.button">下载文件</span>
            </a>
          </div>
        </div>
      </div>
    </main>

    <!-- 使用说明 -->
    <section class="instructions">
      <div class="container">
        <h2 data-i18n="instructions.title">使用说明</h2>
        <div class="row">
          <div class="col-md-4">
            <div class="step">
              <div class="step-number">1</div>
              <h4 data-i18n="instructions.step1.title">选择转换类型</h4>
              <p data-i18n="instructions.step1.desc">
                选择PDF转Word或Word转PDF
              </p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="step">
              <div class="step-number">2</div>
              <h4 data-i18n="instructions.step2.title">上传文件</h4>
              <p data-i18n="instructions.step2.desc">拖拽或点击上传您的文件</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="step">
              <div class="step-number">3</div>
              <h4 data-i18n="instructions.step3.title">下载结果</h4>
              <p data-i18n="instructions.step3.desc">等待转换完成后下载文件</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 付费说明 -->
    <section class="pricing">
      <div class="container">
        <h2 data-i18n="pricing.title">功能对比</h2>
        <div class="row">
          <div class="col-md-6">
            <div class="pricing-card free">
              <h3 data-i18n="pricing.free.title">免费版</h3>
              <ul>
                <li data-i18n="pricing.free.feature1">每日3次转换</li>
                <li data-i18n="pricing.free.feature2">文件大小限制10MB</li>
                <li data-i18n="pricing.free.feature3">基础转换质量</li>
              </ul>
            </div>
          </div>
          <div class="col-md-6">
            <div class="pricing-card premium">
              <h3 data-i18n="pricing.premium.title">付费版</h3>
              <div class="price">$9.99<span>/月</span></div>
              <ul>
                <li data-i18n="pricing.premium.feature1">无限次转换</li>
                <li data-i18n="pricing.premium.feature2">文件大小限制50MB</li>
                <li data-i18n="pricing.premium.feature3">高质量转换</li>
              </ul>
              <button class="btn btn-primary" onclick="showPayment()">
                <span data-i18n="pricing.premium.button">立即升级</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- 页脚 -->
    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <p>&copy; 2024 PDF转Word工具. All rights reserved.</p>
          </div>
          <div class="col-md-6 text-right">
            <a href="#" data-i18n="footer.privacy">隐私政策</a> |
            <a href="#" data-i18n="footer.terms">服务条款</a> |
            <a href="#" data-i18n="footer.contact">联系我们</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- JavaScript -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/main.js"></script>
    <script src="/static/js/upload.js"></script>
    <script src="/static/js/conversion.js"></script>
  </body>
</html>
```

## 3. 后端架构设计

### 3.1 项目结构

```
app/
├── app.py                 # Flask应用主文件
├── config.py             # 配置文件
├── requirements.txt      # Python依赖
├── static/              # 静态文件
├── templates/           # HTML模板
├── uploads/            # 临时上传目录
├── conversions/        # 临时转换目录
└── utils/
    ├── __init__.py
    ├── pdf_converter.py # PDF转换工具
    ├── word_converter.py # Word转换工具
    └── file_validator.py # 文件验证工具
```

### 3.2 Flask 应用主文件

```python
# app.py
from flask import Flask, request, jsonify, send_file, render_template
from werkzeug.utils import secure_filename
import os
import uuid
import threading
import time
from utils.pdf_converter import PDFConverter
from utils.word_converter import WordConverter
from utils.file_validator import FileValidator

app = Flask(__name__)
app.config['MAX_CONTENT_LENGTH'] = 50 * 1024 * 1024  # 50MB
app.config['UPLOAD_FOLDER'] = 'uploads'
app.config['CONVERSION_FOLDER'] = 'conversions'

# 确保目录存在
os.makedirs(app.config['UPLOAD_FOLDER'], exist_ok=True)
os.makedirs(app.config['CONVERSION_FOLDER'], exist_ok=True)

# 转换任务状态
conversion_tasks = {}

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/api/upload', methods=['POST'])
def upload_file():
    try:
        if 'file' not in request.files:
            return jsonify({'error': 'No file provided'}), 400

        file = request.files['file']
        conversion_type = request.form.get('conversion_type', 'pdf-to-word')

        # 验证文件
        validator = FileValidator()
        if not validator.validate_file(file):
            return jsonify({'error': 'Invalid file type or size'}), 400

        # 生成任务ID
        task_id = str(uuid.uuid4())

        # 保存文件
        filename = secure_filename(file.filename)
        file_path = os.path.join(app.config['UPLOAD_FOLDER'], f"{task_id}_{filename}")
        file.save(file_path)

        # 初始化任务状态
        conversion_tasks[task_id] = {
            'status': 'pending',
            'progress': 0,
            'file_path': file_path,
            'conversion_type': conversion_type,
            'result_path': None,
            'error': None
        }

        # 启动转换任务
        thread = threading.Thread(target=convert_file, args=(task_id,))
        thread.start()

        return jsonify({
            'task_id': task_id,
            'status': 'pending'
        })

    except Exception as e:
        return jsonify({'error': str(e)}), 500

@app.route('/api/conversion/status/<task_id>')
def get_conversion_status(task_id):
    if task_id not in conversion_tasks:
        return jsonify({'error': 'Task not found'}), 404

    task = conversion_tasks[task_id]
    response = {
        'task_id': task_id,
        'status': task['status'],
        'progress': task['progress']
    }

    if task['status'] == 'completed':
        response['download_url'] = f'/api/download/{task_id}'
        response['file_size'] = os.path.getsize(task['result_path'])
    elif task['status'] == 'failed':
        response['error'] = task['error']

    return jsonify(response)

@app.route('/api/download/<task_id>')
def download_file(task_id):
    if task_id not in conversion_tasks:
        return jsonify({'error': 'Task not found'}), 404

    task = conversion_tasks[task_id]
    if task['status'] != 'completed':
        return jsonify({'error': 'Conversion not completed'}), 400

    return send_file(
        task['result_path'],
        as_attachment=True,
        download_name=os.path.basename(task['result_path'])
    )

def convert_file(task_id):
    """后台转换文件"""
    task = conversion_tasks[task_id]

    try:
        task['status'] = 'processing'
        task['progress'] = 10

        # 根据转换类型选择转换器
        if task['conversion_type'] == 'pdf-to-word':
            converter = PDFConverter()
            result_path = converter.convert_to_word(task['file_path'])
        else:
            converter = WordConverter()
            result_path = converter.convert_to_pdf(task['file_path'])

        task['progress'] = 100
        task['status'] = 'completed'
        task['result_path'] = result_path

        # 清理原文件
        os.remove(task['file_path'])

    except Exception as e:
        task['status'] = 'failed'
        task['error'] = str(e)

        # 清理文件
        if os.path.exists(task['file_path']):
            os.remove(task['file_path'])

if __name__ == '__main__':
    app.run(debug=True)
```

### 3.3 转换工具类

#### 3.3.1 PDF 转换器

```python
# utils/pdf_converter.py
import PyPDF2
from docx import Document
from docx.shared import Inches
import os

class PDFConverter:
    def convert_to_word(self, pdf_path):
        """将PDF转换为Word文档"""
        try:
            # 读取PDF文件
            with open(pdf_path, 'rb') as file:
                pdf_reader = PyPDF2.PdfReader(file)

                # 创建Word文档
                doc = Document()

                # 提取文本
                for page_num in range(len(pdf_reader.pages)):
                    page = pdf_reader.pages[page_num]
                    text = page.extract_text()

                    # 添加段落
                    if text.strip():
                        doc.add_paragraph(text)

                    # 添加分页符（除了最后一页）
                    if page_num < len(pdf_reader.pages) - 1:
                        doc.add_page_break()

                # 保存Word文档
                output_path = pdf_path.replace('.pdf', '.docx')
                doc.save(output_path)

                return output_path

        except Exception as e:
            raise Exception(f"PDF转换失败: {str(e)}")
```

#### 3.3.2 Word 转换器

```python
# utils/word_converter.py
from docx import Document
from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import letter
import os

class WordConverter:
    def convert_to_pdf(self, word_path):
        """将Word文档转换为PDF"""
        try:
            # 读取Word文档
            doc = Document(word_path)

            # 创建PDF文件
            output_path = word_path.replace('.docx', '.pdf')
            c = canvas.Canvas(output_path, pagesize=letter)
            width, height = letter

            y_position = height - 50  # 起始位置

            # 提取文本并写入PDF
            for paragraph in doc.paragraphs:
                text = paragraph.text
                if text.strip():
                    # 简单的文本换行处理
                    lines = self.wrap_text(text, width - 100)
                    for line in lines:
                        if y_position < 50:  # 需要新页面
                            c.showPage()
                            y_position = height - 50

                        c.drawString(50, y_position, line)
                        y_position -= 20

            c.save()
            return output_path

        except Exception as e:
            raise Exception(f"Word转换失败: {str(e)}")

    def wrap_text(self, text, max_width):
        """简单的文本换行"""
        words = text.split()
        lines = []
        current_line = ""

        for word in words:
            test_line = current_line + " " + word if current_line else word
            if len(test_line) * 6 < max_width:  # 估算字符宽度
                current_line = test_line
            else:
                if current_line:
                    lines.append(current_line)
                current_line = word

        if current_line:
            lines.append(current_line)

        return lines
```

#### 3.3.3 文件验证器

```python
# utils/file_validator.py
import os
from werkzeug.utils import secure_filename

class FileValidator:
    def __init__(self):
        self.allowed_extensions = {
            'pdf': ['.pdf'],
            'word': ['.doc', '.docx']
        }
        self.max_file_size = 50 * 1024 * 1024  # 50MB

    def validate_file(self, file):
        """验证上传的文件"""
        if not file or file.filename == '':
            return False

        # 检查文件扩展名
        filename = secure_filename(file.filename)
        ext = os.path.splitext(filename)[1].lower()

        allowed_exts = self.allowed_extensions['pdf'] + self.allowed_extensions['word']
        if ext not in allowed_exts:
            return False

        # 检查文件大小
        file.seek(0, os.SEEK_END)
        file_size = file.tell()
        file.seek(0)  # 重置文件指针

        if file_size > self.max_file_size:
            return False

        return True

    def get_file_type(self, filename):
        """获取文件类型"""
        ext = os.path.splitext(filename)[1].lower()

        if ext in self.allowed_extensions['pdf']:
            return 'pdf'
        elif ext in self.allowed_extensions['word']:
            return 'word'
        else:
            return None
```

## 4. 部署配置

### 4.1 Gunicorn 配置

```python
# gunicorn.conf.py
bind = "0.0.0.0:8000"
workers = 4
worker_class = "sync"
worker_connections = 1000
timeout = 300
keepalive = 2
max_requests = 1000
max_requests_jitter = 100
preload_app = True
```

### 4.2 Nginx 配置

```nginx
# nginx.conf
server {
    listen 80;
    server_name yourdomain.com;

    # 重定向到HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # 文件上传大小限制
    client_max_body_size 50M;

    # 静态文件
    location /static/ {
        alias /path/to/your/app/static/;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # 应用代理
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # 超时设置
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # 文件下载
    location /api/download/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # 下载优化
        proxy_buffering off;
        proxy_request_buffering off;
    }
}
```

### 4.3 系统服务配置

```ini
# /etc/systemd/system/pdf-converter.service
[Unit]
Description=PDF to Word Converter
After=network.target

[Service]
Type=notify
User=www-data
Group=www-data
WorkingDirectory=/path/to/your/app
Environment=PATH=/path/to/your/venv/bin
ExecStart=/path/to/your/venv/bin/gunicorn -c gunicorn.conf.py app:app
ExecReload=/bin/kill -s HUP $MAINPID
KillMode=mixed
TimeoutStopSec=5
PrivateTmp=true

[Install]
WantedBy=multi-user.target
```

## 5. 安全考虑

### 5.1 文件安全

- 文件类型验证
- 文件大小限制
- 文件名安全处理
- 临时文件自动清理

### 5.2 访问控制

- 请求频率限制
- 文件下载链接过期
- 防止恶意文件上传

### 5.3 数据保护

- 不存储用户文件
- 转换完成后立即删除
- 日志中不记录敏感信息

## 6. 性能优化

### 6.1 前端优化

- 静态文件 CDN 加速
- 图片压缩和优化
- JavaScript 和 CSS 压缩

### 6.2 后端优化

- 异步文件处理
- 内存使用优化
- 并发处理能力

### 6.3 服务器优化

- Nginx 缓存配置
- Gunicorn 工作进程优化
- 系统资源监控

这个简化版本专注于核心功能，技术栈简单，易于开发和维护，适合快速上线。
